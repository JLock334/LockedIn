<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login</title>
    <link rel="stylesheet" href="style.css" />
</head>
<body>
    <ul>
        <li><a href="index.html">Home</a></li>
        <li><a href="Standard.html">Standard Packages</a></li>
        <li><a href="Customized.html">Customized Packages</a></li>
        <li><a href="Profile.html">Profile</a></li>
        <li><a href="About.html">About Us</a></li>
        <li><a href="Contact.html">Contact Us</a></li>
        <li><a href="Sign In.html">Sign In</a></li>
        <li><a href="Chat Bot/index.html">Chat Box</a></li>
        <li><a href="cart.html">Cart</a></li>


    </ul>
    <h1>LockedIn Photography</h1>
    <main>
        <section>

            <h1>Create your Account</h1>
            <form id="createAccountForm">
        <label for="username">Username:</label>
        <input type="text" id="username" name="username" required><br><br>
        <label for="password">Password:</label>
        <input type="password" id="password" name="password" required><br><br>
        <input type="submit" value="Create Account">
    </form>
        </section>
    </main>
    <footer>
        <p>&copy; 2024 Your Company. All rights reserved.</p>
    </footer>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.4/xlsx.full.min.js"></script>
    <script>
        document.getElementById('createAccountForm').addEventListener('submit', function (event) {
            event.preventDefault(); // Prevent form submission

            var username = document.getElementById('username').value.trim();
            var password = document.getElementById('password').value.trim();

            // Fetch existing users.xlsx from GitHub
            fetch('https://github.com/JLock334/LockedIn/tree/main/users/users.xlsx')
                .then(response => response.arrayBuffer())
                .then(arrayBuffer => {
                    var data = new Uint8Array(arrayBuffer);
                    var arr = [];
                    for (var i = 0; i < data.length; ++i) {
                        arr[i] = String.fromCharCode(data[i]);
                    }
                    var bstr = arr.join('');

                    // Convert XLSX to workbook object
                    var workbook = XLSX.read(bstr, { type: 'binary' });
                    var sheetName = workbook.SheetNames[0]; // Assuming the first sheet is users
                    var worksheet = workbook.Sheets[sheetName];
                    var jsonData = XLSX.utils.sheet_to_json(worksheet);

                    // Check if username already exists
                    var userExists = jsonData.some(function (user) {
                        return user.username === username;
                    });

                    if (userExists) {
                        alert('Username already exists. Please choose another.');
                    } else {
                        // Add new user data to jsonData
                        jsonData.push({ username: username, password: password });

                        // Convert jsonData back to worksheet
                        var newWorksheet = XLSX.utils.json_to_sheet(jsonData);

                        // Update existing worksheet with new data
                        workbook.Sheets[sheetName] = newWorksheet;

                        // Convert workbook back to binary XLSX format
                        var wbout = XLSX.write(workbook, { bookType: 'xlsx', type: 'binary' });

                        // Function to convert s to array buffer
                        function s2ab(s) {
                            var buf = new ArrayBuffer(s.length);
                            var view = new Uint8Array(buf);
                            for (var i = 0; i < s.length; i++) {
                                view[i] = s.charCodeAt(i) & 0xFF;
                            }
                            return buf;
                        }

                        // Save Excel file locally (for preview)
                        var blob = new Blob([s2ab(wbout)], { type: 'application/octet-stream' });
                        var url = URL.createObjectURL(blob);
                        window.open(url);

                        alert('Account created successfully!');

                        // Optionally, update the file on GitHub using GitHub Actions
                        // (See GitHub Actions workflow example below)
                    }
                })
                .catch(error => {
                    console.error('Failed to fetch users.xlsx:', error);
                    alert('Failed to fetch users.xlsx. Please try again later.');
                });
        });
    </script>
</body>
</html>
